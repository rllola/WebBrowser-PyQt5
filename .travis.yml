os: osx
language: generic
cache:
  pip: true


before_install:
  - pip install msgpack gevent enum34
  - brew install https://raw.githubusercontent.com/Homebrew/homebrew-core/56c500b569c724b049be7ab9e12d9693f85522f9/Formula/qt.rb
  - chmod +x ./get-pyqt5-osx.sh
  - ./get-pyqt5-osx.sh

install:
  - pip install https://github.com/rllola/pyinstaller/archive/test_pyqt5_from_scratch.zip
  - pip install cffi
  - pip install --upgrade setuptools

script:
  - python main.py
  - pyinstaller --windowed browser.spec
  - ls ./dist/WebBrowser.app/Contents/Resources/PyQt5/Qt/lib
  - ls ./dist/WebBrowser.app/Contents/Resources
  - ls ./dist/WebBrowser.app/Contents/MacOS
  - QTWEBENGINEPROCESS_PATH=./dist/WebBrowser.app/Contents/Resources/lib/QtWebEngineCore.framework/Helpers ./dist/WebBrowser.app/Contents/MacOS/WebBrowser

before_deploy:
  - zip -r build-$TRAVIS_OS_NAME.zip dist/WebBrowser.app

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: $GH_TOKEN
  file:
    - build-$TRAVIS_OS_NAME.zip
  on:
    tags: true
